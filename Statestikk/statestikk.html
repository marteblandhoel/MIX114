<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generated by Codia AI</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap"
    />
    <link rel="stylesheet" href="statestikk.css" />
    <link rel="stylesheet" href="../globals//global.css" type="text/css" />
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/gantt/modules/gantt.js"></script>
    <script src="https://code.highcharts.com/modules/series-label.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <script src="https://code.highcharts.com/dashboards/dashboards.js"></script>
    <script src="https://code.highcharts.com/dashboards/modules/layout.js"></script>
  </head>
  <body>
    <div class="main-container">
      <div id="statesikk_top">
        <span class="accident-statistics">Ulykke-statestikk</span>
        <div class="dropdown">
          <label for="dropdownMenu">Tidligere ulykker på din reiserute:</label>
          <select id="dropdownMenu">
            <option value="">1 År</option>
            <option value="5" selected>5 År</option>
            <option value="10">10 År</option>
            <option value="20">20 År</option>
          </select>
        </div>
      </div>
      <div id="container">
        <div class="row">
          <div class="cell" id="current-sprint-kpi">
            <div class="row" id="current-sprint">
              <div class="cell" id="dashboard-kpi-1"></div>
              <div class="cell" id="dashboard-kpi-2"></div>
            </div>
          </div>
          <div class="cell" id="dashboard-kpi-4"></div>
        </div>
        <div class="row" id="charts-1">
          <div class="cell" id="dashboard-chart-1"></div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var selectedOption = "5"; // Default value to initialize the dashboard
        var dropdownMenu = document.getElementById("dropdownMenu");

        // Event listener for dropdown changes
        dropdownMenu.addEventListener("change", function () {
          selectedOption = this.value; // Update the variable with the new selected option
          fetchDataAndUpdateDashboard(); // Fetch and update the dashboard with the new selection
        });

        // API URL
        const apiUrl = "https://api.npoint.io/c4261b1dc876f9137329";

        // Function to fetch data and update the dashboard
        function fetchDataAndUpdateDashboard() {
          fetch(apiUrl)
            .then((response) => {
              if (!response.ok) {
                throw new Error(
                  "Network response was not ok, status: " + response.status
                );
              }
              return response.json(); // Parse JSON data
            })
            .then((data) => {
              updateDashboardComponents(data); // Update dashboard components with the fetched data
            })
            .catch((error) => {
              console.error("Error fetching data: ", error);
            });
        }

        // Function to update dashboard components based on fetched data
        function updateDashboardComponents(data) {
          const ulykkeData = data.data[0]["Siste" + selectedOption + "År"];
          const ulykke = ulykkeData["AntallAlvorligeUlykker"];
          const dodelig = ulykkeData["AntallDøde"];
          const kpi1 = document.getElementById("dashboard-kpi-1");
          const kpi2 = document.getElementById("dashboard-kpi-2");
          if (kpi1) {
            kpi1.innerHTML = "";
          }
          if (kpi2) {
            kpi2.innerHTML = "";
          }

          // Assuming the dashboard system allows updates like this
          Dashboards.board(
            "container",
            {
              components: [
                {
                  renderTo: "dashboard-kpi-1",
                  type: "KPI",
                  title: "Alvorlige ulykker",
                  subtitle:
                    "antall alvorlige ulykker siste " + selectedOption + " år",
                  value: ulykke, // Set the dynamic value here
                },
                {
                  renderTo: "dashboard-kpi-2",
                  type: "KPI",
                  title: "Dødsfall",
                  subtitle: "antall dødsfall siste " + selectedOption + " år",
                  value: dodelig, // Set the dynamic value here
                },
              ],
            },
            true
          ).then((dashboard) => {
            // Here you might access and use dashboard object methods if additional interactions are needed
          });

          // Update Highcharts for the Pie chart
          Highcharts.chart("dashboard-kpi-4", {
            chart: {
              type: "pie",
            },
            title: {
              text: "Ulykkestype",
            },
            series: [
              {
                name: "Antall",
                data: [
                  {
                    name: "Frontkollisjon",
                    y: ulykkeData.UlykkeType.Frontkollisjon,
                  },
                  {
                    name: "Påkjørsel av fotgjenger",
                    y: ulykkeData.UlykkeType.PåkjørtFotgjenger,
                  },
                  {
                    name: "Påkjøring bakfra",
                    y: ulykkeData.UlykkeType.PåkjøringBakfra,
                  },
                  {
                    name: "Andre ulykker",
                    y: ulykkeData.UlykkeType.AndreUlykker,
                  },
                ],
              },
            ],
          });

          // Update Highcharts for the Column chart
          Highcharts.chart("dashboard-chart-1", {
            chart: {
              type: "column",
            },
            title: {
              text: "Alder og kjønn på ulykkesutsatte",
            },
            xAxis: {
              categories: ["0-20 År", "21-40 År", "41-60 År", "61+ År"],
            },
            series: [
              {
                name: "Kvinne",
                data: [
                  ulykkeData.AlderUtsatte["0-20"].Kvinne,
                  ulykkeData.AlderUtsatte["21-40"].Kvinne,
                  ulykkeData.AlderUtsatte["41-60"].Kvinne,
                  ulykkeData.AlderUtsatte["61+"].Kvinne,
                ],
                color: "pink",
              },
              {
                name: "Mann",
                data: [
                  ulykkeData.AlderUtsatte["0-20"].Mann,
                  ulykkeData.AlderUtsatte["21-40"].Mann,
                  ulykkeData.AlderUtsatte["41-60"].Mann,
                  ulykkeData.AlderUtsatte["61+"].Mann,
                ],
                color: "blue",
              },
            ],
          });
        }

        // Initial call to populate the dashboard
        fetchDataAndUpdateDashboard();
      });
    </script>
    <nav class="navbar">
      <div class="icon-parent">
        <i
          class="iconFooter fa-solid fa-location-dot"
          aria-label="location pin"
        ></i>
        <i
          class="iconFooter fa-solid fa-map-location-dot"
          aria-label="maps icon"
        ></i>
        <i class="iconFooter fa fa-car" aria-label="car icon"></i>
        <i
          class="iconFooter fa fa-exclamation-triangle"
          aria-label="varsel icon"
        ></i>
        <i class="iconFooter fa fa-user-circle-o" aria-label="profile icon"></i>
      </div>
    </nav>
  </body>
</html>
